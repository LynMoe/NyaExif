use simple_log::log::debug;

// Approximate GCJ region in (latitude, longitude) pairs
static GCJ_REGION: &'static [(f64, f64)] = &[
  (52.731367549831, 120.18298955774142),
  (53.63032135052725, 122.50163662235207),
  (53.26176144514083, 125.77607688660949),
  (49.793642660678515, 127.87680506936519),
  (49.407718349606306, 129.66811795485958),
  (47.998560826930955, 131.530512732968),
  (48.51048270954458, 134.84037096447878),
  (45.12562855907086, 133.32895840353396),
  (44.79216287150945, 131.28848995673235),
  (42.63680250697947, 130.45592176815663),
  (42.99527458867438, 129.91790514760166),
  (42.04761801712594, 128.0687300505346),
  (41.45987408769909, 128.10876970001843),
  (41.780407957507286, 126.81985564688428),
  (38.461741231751844, 121.50306067363671),
  (37.414082923391454, 122.93061875172674),
  (30.674023244049664, 123.07426160685057),
  (24.6033327288128, 119.22457427978614),
  (21.179240961699527, 112.43694704179752),
  (17.673075974060612, 109.48709815312112),
  (19.138508820560002, 108.18083521881559),
  (21.39327464004528, 108.15083770831288),
  (22.080063041679676, 106.60666332280034),
  (22.71632309622958, 106.5008040544447),
  (23.13617888669703, 105.0537266093335),
  (22.32102047283515, 101.78903194655028),
  (21.091729915864516, 101.81916659472037),
  (21.497462709277563, 100.27712620789795),
  (22.172525330672745, 99.21924485723063),
  (23.922710480065003, 97.59174752286235),
  (24.7766324211775, 97.52779222878526),
  (25.979741935612175, 98.59304557492919),
  (27.518813240263356, 98.41488901761588),
  (29.255978242960396, 96.05290813407619),
  (28.98351539963584, 94.3743597614614),
  (27.73202645570489, 91.91576503922244),
  (27.954988751231465, 89.43637256086063),
  (27.305474672237125, 88.87924298495538),
  (27.926305488252357, 85.9660573850956),
  (30.018093251412424, 81.1821861261154),
  (31.29101575822806, 78.8959522774237),
  (32.51080027519665, 78.40327588060015),
  (32.70102288420409, 79.42731032370726),
  (34.73972040936371, 78.19756139986893),
  (35.46498638604698, 78.08744745345531),
  (35.827127091240776, 76.13888392627935),
  (36.12722522700187, 75.92489090497999),
  (36.74619160023912, 75.56385329098687),
  (37.09152700706339, 74.49469911660775),
  (37.36092398871107, 75.07085973927778),
  (38.52410020540065, 73.96571879042757),
  (39.45869189286305, 73.55981403057588),
  (40.48588468250351, 74.8404885479942),
  (41.4079098041435, 78.18892031992831),
  (42.209549490371245, 80.1685385590239),
  (43.0232779792319, 80.3924877595656),
  (44.92499622938564, 79.91450165082203),
  (45.27242675378137, 82.50522457891103),
  (47.22146706317084, 82.95321261550617),
  (47.06392532516057, 85.49226819096441),
  (48.43342505864067, 85.73634505323675),
  (49.146033236672466, 86.88083279984656),
  (49.157812554992795, 87.77826911573229),
  (47.862960480730074, 90.01921884921369),
  (46.02248151184977, 91.03156364579425),
  (45.21092618689381, 90.84795164769706),
  (44.33814457729536, 95.3781833450865),
  (42.77559669230801, 96.46889449961684),
  (42.50247036887638, 101.82589397754059),
  (41.939925797616525, 105.58392770472803),
  (42.757160841682044, 110.1889382502376),
  (43.753981039668, 111.87813257735903),
  (45.081602850466446, 111.76814565537664),
  (46.755407823982075, 119.02228883676571),
  (47.248791064053286, 119.54348219864653),
  (48.022727706580255, 117.82995057487629),
  (47.630522239677866, 117.36286596647822),
  (47.91831453430476, 115.56839450099663),
  (49.83589917843746, 116.6729235427556),
  (50.3781951866589, 119.13757348710827),
  (52.11976005858193, 120.72835099286257),
  (52.5816732367262, 120.15157047622971)
];

pub fn is_point_in_gcj_region(point: (f64, f64)) -> bool {
  let mut count = 0;
  let (px, py) = point;
  let mut j = GCJ_REGION.len() - 1;
  for i in 0..GCJ_REGION.len() {
      let (sx, sy) = GCJ_REGION[i];
      let (ex, ey) = GCJ_REGION[j];
      if (sy < py && ey >= py) || (ey < py && sy >= py) {
          if sx + (py - sy) / (ey - sy) * (ex - sx) < px {
              count += 1;
          }
      }
      j = i;
  }

  debug!("[Util Loca inGcj] Pair {:?}, count {}, in region: {}", point, count, count % 2 != 0);
  count % 2 != 0
}
